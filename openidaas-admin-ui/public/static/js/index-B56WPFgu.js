import{v as W,ay as Z,ax as J,k as X,ac as d,y as u,D as g,aD as Y,E as a,F as o,G as s,U as ee,u as p,z as E,an as te,S as k,R as I,$ as se,r as i,c as ae,l as oe,n as T}from"./vue-vendor-BojGzKWy.js";import{u as le,_ as ne}from"./index-MeEtieb6.js";import{u as re,l as ie,h as de,k as ue,r as pe,j as ce,m as me,e as U,E as S}from"./element-plus-CD8Xv7xU.js";import"./axios-C0Zqfgkc.js";const fe={class:"login-container"},ve={class:"input-wrapper"},ge={class:"input-icon"},_e={class:"input-wrapper"},we={class:"input-icon"},he={key:0},ke={class:"input-wrapper"},ye={class:"input-icon"},be={key:0},Ce={key:1},Ee={class:"remember-me"},xe={class:"auth-links"},Ve={class:"social-login"},Fe={class:"social-icons"},Re={key:1,class:"security-tip"},Me="IDaaS管理系统",Ae=W({__name:"index",setup(Ne){const x=Z(),L=J(),V=le(),y=i(),$=i(),F=i(),R=i(),f=i(!1),c=i("password"),_=i(!1),M=i(!1),w=i(!1),O=i(!1),A=i(0),z=ae(()=>f.value||!n.username.trim()||!n.password.trim()),n=oe({username:"",password:"",mfaCode:""}),q={username:[{validator:(l,e,t)=>{e?/^([\w\.\-]+)@([\w\-]+\.)+([\w]{2,})$|^1[3-9]\d{9}$/.test(e)?t():t(new Error("请输入有效的邮箱或手机号")):t(new Error("请输入邮箱或手机号"))},trigger:"blur"},{required:!0,message:"请输入邮箱或手机号",trigger:"blur"}],password:[{validator:(l,e,t)=>{e?e.length<6?t(new Error("密码长度不能少于6位")):e.length>20?t(new Error("密码长度不能超过20位")):t():t(new Error("请输入密码"))},trigger:"blur"},{required:!0,message:"请输入密码",trigger:"blur"}],mfaCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:/^\d{6}$/,message:"验证码格式不正确",trigger:"blur"}]},K=l=>{const{key:e}=l;_.value=!!(e&&e.length===1&&e>="A"&&e<="Z")},H=()=>{c.value==="password"?c.value="":c.value="password",T(()=>{var l;(l=F.value)==null||l.focus()})},N=async()=>{y.value&&await y.value.validate(async l=>{if(l){f.value=!0;try{await V.login({username:n.username,password:n.password,mfaCode:n.mfaCode||void 0}),U.success({title:"登录成功",message:"正在为您跳转...",duration:1500}),w.value&&localStorage.setItem("rememberMe","true");const e=L.query.redirect||"/";setTimeout(()=>{x.push({path:e})},1500)}catch(e){console.error("登录失败:",e),A.value++;let t="",v="登录失败";switch(e.code){case"ACCOUNT_NOT_FOUND":t="账号不存在，请检查输入或立即注册";break;case"INVALID_CREDENTIALS":const m=Math.max(0,5-A.value);t=`密码错误，您还有${m}次尝试机会`,m<=2&&(t+=" 或 忘记密码？");break;case"ACCOUNT_LOCKED":t="账号因多次输错密码已锁定，请15分钟后重试或联系客服";break;case"MFA_REQUIRED":M.value=!0,T(()=>{var h;(h=R.value)==null||h.focus()});return;case"INVALID_MFA_CODE":t="验证码错误，请重新输入";break;case"NETWORK_ERROR":t="网络连接失败，请检查网络后重试";break;default:t=e.message||"登录失败，请稍后重试"}U.error({title:v,message:t,duration:4e3})}finally{f.value=!1}}})},b=l=>{var t;(t=l.target.parentElement)==null||t.classList.add("focused")},P=l=>{var t;(t=l.target.parentElement)==null||t.classList.remove("focused")},G=()=>{S.info("验证码已刷新")},B=l=>{S.info(`正在使用${l==="wechat"?"微信":"Google"}登录`)};return X(()=>{localStorage.getItem("rememberMe")==="true"&&(w.value=!0),V.isAuthenticated&&x.push({path:"/"})}),(l,e)=>{const t=d("el-icon"),v=d("el-input"),m=d("el-form-item"),h=d("el-tooltip"),C=d("el-button"),j=d("el-checkbox"),D=d("router-link"),Q=d("el-alert");return u(),g("div",fe,[e[19]||(e[19]=Y('<div class="background-animation" data-v-0a617d04><div class="floating-shape shape-1" data-v-0a617d04></div><div class="floating-shape shape-2" data-v-0a617d04></div><div class="floating-shape shape-3" data-v-0a617d04></div><div class="floating-shape shape-4" data-v-0a617d04></div></div>',1)),a(p(me),{ref_key:"loginFormRef",ref:y,model:n,rules:q,class:"login-form",autocomplete:"on","label-position":"left"},{default:o(()=>[s("div",{class:"title-container"},[e[8]||(e[8]=s("div",{class:"logo-wrapper"},[s("div",{class:"logo-animation"},[s("svg",{viewBox:"0 0 100 100",class:"logo-svg"},[s("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#409EFF","stroke-width":"2"}),s("path",{d:"M30,50 L45,65 L70,35",fill:"none",stroke:"#409EFF","stroke-width":"3","stroke-linecap":"round"})])])],-1)),s("h1",{class:"title"},ee(Me)),e[9]||(e[9]=s("p",{class:"subtitle"},"安全可靠的身份认证平台",-1))]),a(m,{prop:"username"},{default:o(()=>[s("div",ve,[s("span",ge,[a(t,null,{default:o(()=>[a(p(re))]),_:1})]),a(v,{ref_key:"usernameRef",ref:$,modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=r=>n.username=r),placeholder:"请输入邮箱或手机号",name:"username",type:"text",tabindex:"1",autocomplete:"on",class:"animated-input",onFocus:b,onBlur:P},null,8,["modelValue"])]),e[10]||(e[10]=s("div",{class:"input-hint"},"支持邮箱或手机号登录",-1))]),_:1}),a(h,{visible:_.value,"onUpdate:visible":e[3]||(e[3]=r=>_.value=r),content:"大写锁定已开启",placement:"right",manual:""},{default:o(()=>[a(m,{prop:"password"},{default:o(()=>[s("div",_e,[s("span",we,[a(t,null,{default:o(()=>[a(p(ie))]),_:1})]),(u(),E(v,{key:c.value,ref_key:"passwordRef",ref:F,modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=r=>n.password=r),type:c.value,placeholder:"请输入密码",name:"password",tabindex:"2",autocomplete:"on",class:"animated-input",onKeyup:[te(N,["enter"]),K],onBlur:e[2]||(e[2]=r=>_.value=!1),onFocus:b},null,8,["modelValue","type"])),s("span",{class:"show-pwd",onClick:H},[a(t,null,{default:o(()=>[c.value==="password"?(u(),g("view",he)):(u(),E(p(de),{key:1}))]),_:1})])]),e[11]||(e[11]=s("div",{class:"input-hint"},"建议6-20位，包含字母和数字",-1))]),_:1})]),_:1},8,["visible"]),M.value?(u(),E(m,{key:0,prop:"mfaCode"},{default:o(()=>[s("div",ke,[s("span",ye,[a(t,null,{default:o(()=>[a(p(ue))]),_:1})]),a(v,{ref_key:"mfaCodeRef",ref:R,modelValue:n.mfaCode,"onUpdate:modelValue":e[4]||(e[4]=r=>n.mfaCode=r),placeholder:"请输入验证码",name:"mfaCode",type:"text",tabindex:"3",autocomplete:"off",maxlength:"6",class:"animated-input",onFocus:b},null,8,["modelValue"]),s("span",{class:"refresh-captcha",onClick:G},[a(t,null,{default:o(()=>[a(p(pe))]),_:1}),e[12]||(e[12]=k(" 看不清？换一张 ",-1))])])]),_:1})):I("",!0),a(C,{loading:f.value,type:"primary",class:"login-button animated-button",onClick:se(N,["prevent"]),disabled:z.value},{default:o(()=>[f.value?(u(),g("span",Ce,"登录中...")):(u(),g("span",be,"安全登录"))]),_:1},8,["loading","disabled"]),s("div",Ee,[a(j,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=r=>w.value=r)},{default:o(()=>[...e[13]||(e[13]=[k("记住登录状态",-1)])]),_:1},8,["modelValue"])]),s("div",xe,[a(D,{to:"/forgot-password",class:"link-item"},{default:o(()=>[...e[14]||(e[14]=[k(" 忘记密码？ ",-1)])]),_:1}),e[16]||(e[16]=s("span",{class:"divider"},"|",-1)),a(D,{to:"/register",class:"link-item"},{default:o(()=>[...e[15]||(e[15]=[k(" 立即注册 ",-1)])]),_:1})]),s("div",Ve,[e[18]||(e[18]=s("p",{class:"social-title"},"或使用以下方式登录",-1)),s("div",Fe,[a(C,{circle:"",class:"social-btn",onClick:e[6]||(e[6]=r=>B("wechat"))},{default:o(()=>[a(t,null,{default:o(()=>[a(p(ce))]),_:1})]),_:1}),a(C,{circle:"",class:"social-btn",onClick:e[7]||(e[7]=r=>B("google"))},{default:o(()=>[...e[17]||(e[17]=[s("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[s("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),s("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),s("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),s("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})],-1)])]),_:1})])]),O.value?(u(),g("div",Re,[a(Q,{title:"检测到新设备登录",type:"info",description:"已发送验证邮件至您的邮箱，请查收","show-icon":"",closable:!1})])):I("",!0)]),_:1},8,["model"])])}}}),Le=ne(Ae,[["__scopeId","data-v-0a617d04"]]);export{Le as default};
