openapi: 3.0.3
info:
  title: IDaaS系统API接口文档
  description: |
    IDaaS（Identity as a Service）系统API接口规范，提供统一的身份认证、授权管理和身份治理服务。
    
    ## 系统特性
    - 统一身份认证与单点登录
    - 多因子认证支持
    - RBAC/ABAC混合权限模型
    - 组织架构管理
    - 应用集成与联邦身份
    - 身份治理与合规审计
    
    ## 认证方式
    - Bearer Token (JWT)
    - OAuth2.0
    - OpenID Connect
    
    ## 错误响应格式
    ```json
    {
      "code": "ERROR_CODE",
      "message": "错误描述信息",
      "timestamp": "2024-01-01T12:00:00Z",
      "path": "/api/resource"
    }
    ```
  version: 10.3.2
  contact:
    name: Qoobot开发团队
    email: dev@qoobot.com
    url: https://github.com/qoobot-com/openidaas
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.idaas.example.com
    description: 生产环境
  - url: https://test-api.idaas.example.com
    description: 测试环境
  - url: http://localhost:8080
    description: 本地开发环境

tags:
  - name: authentication
    description: 认证服务接口
  - name: users
    description: 用户管理接口
  - name: organizations
    description: 组织架构管理接口
  - name: roles
    description: 角色权限管理接口
  - name: applications
    description: 应用管理接口
  - name: authorization
    description: 授权服务接口
  - name: audit
    description: 审计日志接口
  - name: tenants
    description: 租户管理接口

paths:
  # 认证相关接口
  /api/auth/login:
    post:
      tags: [authentication]
      summary: 用户登录认证
      description: 用户通过用户名密码进行登录认证，支持多因子认证
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: 登录尝试过于频繁

  /api/auth/logout:
    post:
      tags: [authentication]
      summary: 用户登出
      description: 用户主动登出，使当前会话失效
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 登出成功
        '401':
          description: 未认证

  /api/auth/refresh:
    post:
      tags: [authentication]
      summary: 刷新访问令牌
      description: 使用刷新令牌获取新的访问令牌
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: 令牌刷新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '401':
          description: 刷新令牌无效

  /api/auth/mfa/setup:
    post:
      tags: [authentication]
      summary: 设置多因子认证
      description: 为用户配置多因子认证方式
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MFASetupRequest'
      responses:
        '200':
          description: MFA设置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MFASetupResponse'
        '400':
          description: 请求参数错误

  # 用户管理接口
  /api/users:
    get:
      tags: [users]
      summary: 查询用户列表
      description: 分页查询用户信息，支持多种筛选条件
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - $ref: '#/components/parameters/sort'
        - name: username
          in: query
          description: 用户名模糊查询
          schema:
            type: string
        - name: email
          in: query
          description: 邮箱精确查询
          schema:
            type: string
        - name: status
          in: query
          description: 用户状态筛选
          schema:
            $ref: '#/components/schemas/UserStatus'
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseUser'
        '401':
          description: 未认证
        '403':
          description: 权限不足

    post:
      tags: [users]
      summary: 创建用户
      description: 创建新的用户账户
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: 用户创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: 请求参数错误
        '409':
          description: 用户名或邮箱已存在

  /api/users/{id}:
    get:
      tags: [users]
      summary: 获取用户详情
      description: 根据用户ID获取用户详细信息
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetail'
        '404':
          description: 用户不存在

    put:
      tags: [users]
      summary: 更新用户信息
      description: 更新用户基本信息和档案信息
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: 请求参数错误
        '404':
          description: 用户不存在

    delete:
      tags: [users]
      summary: 删除用户
      description: 逻辑删除用户账户
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: 删除成功
        '404':
          description: 用户不存在

  /api/users/{id}/departments:
    post:
      tags: [users]
      summary: 分配用户部门
      description: 为用户分配部门和职位关系
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignDepartmentRequest'
      responses:
        '200':
          description: 分配成功
        '400':
          description: 请求参数错误
        '404':
          description: 用户或部门不存在
        '409':
          description: 部门关系已存在

  /api/users/{id}/roles:
    post:
      tags: [users]
      summary: 分配用户角色
      description: 为用户分配角色和权限
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignRoleRequest'
      responses:
        '200':
          description: 分配成功
        '400':
          description: 请求参数错误
        '404':
          description: 用户或角色不存在
        '409':
          description: 角色已分配

  # 组织架构接口
  /api/organizations/departments:
    get:
      tags: [organizations]
      summary: 获取部门树
      description: 获取完整的组织架构树形结构
      security:
        - bearerAuth: []
      parameters:
        - name: parentId
          in: query
          description: 父部门ID，为空时返回根部门
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DepartmentTree'

    post:
      tags: [organizations]
      summary: 创建部门
      description: 创建新的部门
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDepartmentRequest'
      responses:
        '201':
          description: 部门创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '400':
          description: 请求参数错误
        '409':
          description: 部门编码已存在

    put:
      tags: [organizations]
      summary: 更新部门
      description: 更新部门信息
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDepartmentRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '400':
          description: 请求参数错误
        '404':
          description: 部门不存在

    delete:
      tags: [organizations]
      summary: 删除部门
      description: 删除指定部门（需确保无下属部门和用户）
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          description: 部门ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: 删除成功
        '400':
          description: 部门存在关联数据，无法删除
        '404':
          description: 部门不存在

  /api/organizations/positions:
    get:
      tags: [organizations]
      summary: 获取职位列表
      description: 查询职位信息列表
      security:
        - bearerAuth: []
      parameters:
        - name: deptId
          in: query
          description: 部门ID筛选
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Position'

    post:
      tags: [organizations]
      summary: 创建职位
      description: 创建新的职位
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePositionRequest'
      responses:
        '201':
          description: 职位创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'
        '400':
          description: 请求参数错误
        '409':
          description: 职位编码已存在

  /api/auth/reset-password:
    post:
      tags: [authentication]
      summary: 重置密码
      description: 管理员重置用户密码或用户自助重置密码
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: 密码重置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResetPasswordResponse'
        '400':
          description: 请求参数错误
        '403':
          description: 权限不足
        '404':
          description: 用户不存在

  # 角色权限接口
  /api/roles:
    get:
      tags: [roles]
      summary: 查询角色列表
      description: 分页查询角色信息
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - name: roleName
          in: query
          description: 角色名称模糊查询
          schema:
            type: string
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseRole'

    post:
      tags: [roles]
      summary: 创建角色
      description: 创建新的角色定义
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoleRequest'
      responses:
        '201':
          description: 角色创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /api/roles/{id}/permissions:
    get:
      tags: [roles]
      summary: 获取角色权限
      description: 获取指定角色拥有的权限列表
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 角色ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permission'

    post:
      tags: [roles]
      summary: 分配角色权限
      description: 为角色分配权限
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 角色ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignPermissionRequest'
      responses:
        '200':
          description: 权限分配成功

  # 应用管理接口
  /api/applications:
    get:
      tags: [applications]
      summary: 查询应用列表
      description: 分页查询已注册的应用信息
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - name: appName
          in: query
          description: 应用名称模糊查询
          schema:
            type: string
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseApplication'

    post:
      tags: [applications]
      summary: 注册应用
      description: 注册新的第三方应用
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApplicationRequest'
      responses:
        '201':
          description: 应用注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Application'

  # 授权接口
  /api/authorization/check:
    post:
      tags: [authorization]
      summary: 权限检查
      description: 检查用户是否具有指定权限
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PermissionCheckRequest'
      responses:
        '200':
          description: 权限检查结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionCheckResponse'

  # 审计日志接口
  /api/audit/logs:
    get:
      tags: [audit]
      summary: 查询审计日志
      description: 分页查询系统操作审计日志
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - name: userId
          in: query
          description: 用户ID筛选
          schema:
            type: integer
            format: int64
        - name: action
          in: query
          description: 操作类型筛选
          schema:
            type: string
        - name: startTime
          in: query
          description: 开始时间
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: 结束时间
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseAuditLog'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    page:
      name: page
      in: query
      description: 页码（从0开始）
      schema:
        type: integer
        minimum: 0
        default: 0
    size:
      name: size
      in: query
      description: 每页大小
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    sort:
      name: sort
      in: query
      description: 排序字段，格式为field,asc|desc
      schema:
        type: string
        default: createdAt,desc

  schemas:
    # 认证相关
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: 用户名或邮箱
          example: "john.doe"
        password:
          type: string
          description: 密码
          format: password
          example: "Password123!"
        mfaCode:
          type: string
          description: 多因子认证验证码
          example: "123456"

    LoginResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: 访问令牌
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: 刷新令牌
          example: "dGhpcyBpcyBhIHJlZnJlc2ggdG9rZW4..."
        expiresIn:
          type: integer
          description: 访问令牌过期时间（秒）
          example: 3600
        tokenType:
          type: string
          description: 令牌类型
          example: "Bearer"
        userInfo:
          $ref: '#/components/schemas/UserInfo'

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: 刷新令牌

    RefreshTokenResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: 新的访问令牌
        expiresIn:
          type: integer
          description: 过期时间（秒）

    MFASetupRequest:
      type: object
      required:
        - factorType
      properties:
        factorType:
          type: string
          description: 认证因素类型
          enum: [SMS, EMAIL, TOTP, HARDWARE_TOKEN]
        phoneNumber:
          type: string
          description: 手机号码（SMS认证时必填）
        email:
          type: string
          description: 邮箱地址（EMAIL认证时必填）

    MFASetupResponse:
      type: object
      properties:
        factorId:
          type: integer
          format: int64
          description: 认证因素ID
        qrCode:
          type: string
          description: TOTP二维码（Base64编码）
        secret:
          type: string
          description: TOTP密钥

    # 用户相关
    UserStatus:
      type: string
      description: 用户状态枚举
      enum: [ACTIVE, LOCKED, DISABLED, DELETED]

    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 用户ID
        username:
          type: string
          description: 用户名
        email:
          type: string
          description: 邮箱地址
        mobile:
          type: string
          description: 手机号码
        status:
          $ref: '#/components/schemas/UserStatus'
        createdAt:
          type: string
          format: date-time
          description: 创建时间
        updatedAt:
          type: string
          format: date-time
          description: 更新时间

    UserDetail:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            profile:
              $ref: '#/components/schemas/UserProfile'
            departments:
              type: array
              items:
                $ref: '#/components/schemas/UserDepartment'
            roles:
              type: array
              items:
                $ref: '#/components/schemas/UserRoleAssignment'

    UserInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        fullName:
          type: string
        avatar:
          type: string
        permissions:
          type: array
          items:
            type: string
        roles:
          type: array
          items:
            type: string

    UserProfile:
      type: object
      properties:
        fullName:
          type: string
          description: 真实姓名
        nickname:
          type: string
          description: 昵称
        gender:
          type: integer
          description: 性别（1-男，2-女，0-未知）
        birthDate:
          type: string
          format: date
          description: 出生日期
        avatarUrl:
          type: string
          description: 头像URL
        employeeId:
          type: string
          description: 员工编号

    UserDepartment:
      type: object
      properties:
        deptId:
          type: integer
          format: int64
        deptName:
          type: string
        isPrimary:
          type: boolean
        positionId:
          type: integer
          format: int64
        positionName:
          type: string

    UserRoleAssignment:
      type: object
      properties:
        roleId:
          type: integer
          format: int64
        roleName:
          type: string
        scopeType:
          type: string
          description: 作用域类型
        scopeId:
          type: integer
          format: int64
        expireTime:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
          pattern: '^[a-zA-Z0-9_]+$'
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]'
        profile:
          $ref: '#/components/schemas/UserProfile'
        departmentIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          maxLength: 128
          description: 邮箱地址
        mobile:
          type: string
          pattern: '^1[3-9]\d{9}$'
          description: 手机号码
        profile:
          $ref: '#/components/schemas/UserProfile'
        status:
          $ref: '#/components/schemas/UserStatus'

    # 用户部门分配相关
    AssignDepartmentRequest:
      type: object
      required:
        - deptId
        - isPrimary
      properties:
        deptId:
          type: integer
          format: int64
          description: 部门ID
          minimum: 1
        positionId:
          type: integer
          format: int64
          description: 职位ID
        isPrimary:
          type: boolean
          description: 是否为主部门
          default: true
        startDate:
          type: string
          format: date
          description: 开始日期
        endDate:
          type: string
          format: date
          description: 结束日期

    # 用户角色分配相关
    AssignRoleRequest:
      type: object
      required:
        - roleId
      properties:
        roleId:
          type: integer
          format: int64
          description: 角色ID
          minimum: 1
        scopeType:
          type: integer
          description: 作用域类型（1-全局，2-部门，3-项目）
          default: 1
          enum: [1, 2, 3]
        scopeId:
          type: integer
          format: int64
          description: 作用域ID
        expireTime:
          type: string
          format: date-time
          description: 过期时间
        grantReason:
          type: string
          maxLength: 500
          description: 授权原因

    # 部门管理相关
    Department:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 部门ID
        deptCode:
          type: string
          maxLength: 64
          description: 部门编码
        deptName:
          type: string
          maxLength: 128
          description: 部门名称
        parentId:
          type: integer
          format: int64
          description: 父部门ID
        levelPath:
          type: string
          maxLength: 512
          description: 层级路径
        levelDepth:
          type: integer
          description: 层级深度
        sortOrder:
          type: integer
          description: 排序序号
        managerId:
          type: integer
          format: int64
          description: 部门经理ID
        description:
          type: string
          maxLength: 1000
          description: 部门描述
        status:
          type: integer
          description: 状态（1-启用，2-禁用）
          enum: [1, 2]
        createdAt:
          type: string
          format: date-time
          description: 创建时间
        updatedAt:
          type: string
          format: date-time
          description: 更新时间

    CreateDepartmentRequest:
      type: object
      required:
        - deptCode
        - deptName
      properties:
        deptCode:
          type: string
          minLength: 2
          maxLength: 64
          pattern: '^[A-Z0-9_]+$'
          description: 部门编码（大写字母、数字、下划线）
        deptName:
          type: string
          minLength: 2
          maxLength: 128
          description: 部门名称
        parentId:
          type: integer
          format: int64
          description: 父部门ID，0表示根部门
          default: 0
        sortOrder:
          type: integer
          description: 排序序号
          default: 0
        managerId:
          type: integer
          format: int64
          description: 部门经理ID
        description:
          type: string
          maxLength: 1000
          description: 部门描述

    UpdateDepartmentRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int64
          description: 部门ID
          minimum: 1
        deptName:
          type: string
          minLength: 2
          maxLength: 128
          description: 部门名称
        parentId:
          type: integer
          format: int64
          description: 父部门ID
        sortOrder:
          type: integer
          description: 排序序号
        managerId:
          type: integer
          format: int64
          description: 部门经理ID
        description:
          type: string
          maxLength: 1000
          description: 部门描述
        status:
          type: integer
          description: 状态（1-启用，2-禁用）
          enum: [1, 2]

    # 职位管理相关
    CreatePositionRequest:
      type: object
      required:
        - positionCode
        - positionName
        - deptId
      properties:
        positionCode:
          type: string
          minLength: 2
          maxLength: 64
          pattern: '^[A-Z0-9_]+$'
          description: 职位编码（大写字母、数字、下划线）
        positionName:
          type: string
          minLength: 2
          maxLength: 128
          description: 职位名称
        deptId:
          type: integer
          format: int64
          description: 所属部门ID
          minimum: 1
        level:
          type: integer
          description: 职级等级
          minimum: 1
          maximum: 20
        jobGrade:
          type: string
          maxLength: 32
          description: 职级
        reportsTo:
          type: integer
          format: int64
          description: 汇报对象职位ID
        isManager:
          type: boolean
          description: 是否管理岗位
          default: false
        description:
          type: string
          maxLength: 1000
          description: 职位描述

    # 密码重置相关
    ResetPasswordRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: integer
          format: int64
          description: 用户ID
          minimum: 1
        newPassword:
          type: string
          minLength: 8
          maxLength: 128
          pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]'
          description: 新密码（必须包含大小写字母、数字、特殊字符）
        confirmPassword:
          type: string
          description: 确认密码
        resetReason:
          type: string
          maxLength: 500
          description: 重置原因

    ResetPasswordResponse:
      type: object
      properties:
        userId:
          type: integer
          format: int64
          description: 用户ID
        resetTime:
          type: string
          format: date-time
          description: 重置时间
        resetBy:
          type: integer
          format: int64
          description: 重置操作人ID
        message:
          type: string
          description: 操作结果消息

    # 组织架构相关
    DepartmentTree:
      type: object
      properties:
        id:
          type: integer
          format: int64
        deptCode:
          type: string
        deptName:
          type: string
        parentId:
          type: integer
          format: int64
        levelPath:
          type: string
        sortOrder:
          type: integer
        children:
          type: array
          items:
            $ref: '#/components/schemas/DepartmentTree'

    Position:
      type: object
      properties:
        id:
          type: integer
          format: int64
        positionCode:
          type: string
        positionName:
          type: string
        deptId:
          type: integer
          format: int64
        level:
          type: integer
        jobGrade:
          type: string
        reportsTo:
          type: integer
          format: int64

    # 角色权限相关
    Role:
      type: object
      properties:
        id:
          type: integer
          format: int64
        roleCode:
          type: string
        roleName:
          type: string
        roleType:
          type: integer
          description: 角色类型（1-系统角色，2-自定义角色）
        parentId:
          type: integer
          format: int64
        description:
          type: string

    Permission:
      type: object
      properties:
        id:
          type: integer
          format: int64
        permCode:
          type: string
        permName:
          type: string
        resourceType:
          type: string
        resourceId:
          type: string
        action:
          type: string

    CreateRoleRequest:
      type: object
      required:
        - roleCode
        - roleName
      properties:
        roleCode:
          type: string
        roleName:
          type: string
        roleType:
          type: integer
          default: 2
        parentId:
          type: integer
          format: int64
        description:
          type: string
        permissionIds:
          type: array
          items:
            type: integer
            format: int64

    AssignPermissionRequest:
      type: object
      required:
        - permissionIds
      properties:
        permissionIds:
          type: array
          items:
            type: integer
            format: int64

    # 应用管理相关
    Application:
      type: object
      properties:
        id:
          type: integer
          format: int64
        appKey:
          type: string
        appName:
          type: string
        appType:
          type: integer
          description: 应用类型（1-Web，2-移动，3-API）
        redirectUris:
          type: array
          items:
            type: string
        logoUrl:
          type: string
        homepageUrl:
          type: string
        status:
          type: integer
          description: 状态（1-启用，2-禁用）

    CreateApplicationRequest:
      type: object
      required:
        - appName
        - appType
        - redirectUris
      properties:
        appName:
          type: string
        appType:
          type: integer
        redirectUris:
          type: array
          items:
            type: string
        logoUrl:
          type: string
        homepageUrl:
          type: string
        description:
          type: string

    # 授权相关
    PermissionCheckRequest:
      type: object
      required:
        - permissions
      properties:
        userId:
          type: integer
          format: int64
          description: 用户ID，为空时检查当前用户
        permissions:
          type: array
          items:
            type: string
          description: 权限编码列表

    PermissionCheckResponse:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        results:
          type: object
          description: 权限检查结果映射
          additionalProperties:
            type: boolean

    # 审计日志相关
    AuditLog:
      type: object
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        username:
          type: string
        action:
          type: string
        resourceType:
          type: string
        resourceId:
          type: string
        clientIp:
          type: string
        userAgent:
          type: string
        logTime:
          type: string
          format: date-time

    # 分页响应
    PageResponseUser:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/User'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        size:
          type: integer
        number:
          type: integer
        first:
          type: boolean
        last:
          type: boolean

    PageResponseRole:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        size:
          type: integer
        number:
          type: integer

    PageResponseApplication:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Application'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        size:
          type: integer
        number:
          type: integer

    PageResponseAuditLog:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AuditLog'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        size:
          type: integer
        number:
          type: integer

    # 错误响应
    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          description: 错误码
        message:
          type: string
          description: 错误描述
        timestamp:
          type: string
          format: date-time
        path:
          type: string
          description: 请求路径