# IDaaS系统应用架构设计提示词

## 系统整体架构要求

作为资深架构师，请基于SpringBoot 3.5.10 + Vue3的技术栈，设计一个高可用、可扩展的IDaaS系统应用架构。系统需满足企业级身份管理的所有核心功能需求，并具备良好的性能、安全性和可维护性。

## 微服务架构设计

### 服务拆分策略

**核心服务模块：**

1. **用户管理服务（openidaas-user-service）**
   - 用户账户生命周期管理
   - 个人资料与扩展属性管理
   - 用户状态流转控制
   - 密码策略执行引擎

2. **认证服务（openidaas-auth-service）**
   - 统一认证入口与协议适配
   - 多因子认证支持（MFA）
   - 社交登录集成
   - 自适应认证引擎
   - 会话管理与令牌服务

3. **授权服务（openidaas-authz-service）**
   - RBAC/ABAC权限引擎
   - 单点登录协议实现
   - API网关与访问控制
   - 动态权限计算
   - OAuth2.0/OIDC服务端

4. **组织管理服务（openidaas-org-service）**
   - 组织架构树管理
   - 职位与汇报关系
   - 部门管理员委派
   - 动态组管理

5. **应用管理服务（openidaas-app-service）**
   - 应用目录注册
   - SSO配置管理
   - 权限映射配置
   - 应用生命周期管理

6. **联合身份服务（openidaas-federation-service）**
   - SAML 2.0协议处理
   - SCIM 2.0同步引擎
   - 外部IDP集成
   - 属性映射服务

7. **治理服务（openidaas-governance-service）**
   - 访问审查引擎
   - 权限分析与可视化
   - 合规报告生成
   - 审批工作流

8. **安全管理服务（openidaas-security-service）**
   - 威胁检测引擎
   - 行为分析服务
   - 设备指纹管理
   - 安全事件处理

9. **运营管理服务（openidaas-operation-service）**
   - 多租户管理
   - 运营统计分析
   - 计费管理
   - 系统监控告警

### 服务间通信设计

**异步消息机制：**
- 使用Apache Kafka/RabbitMQ处理异步事件
- 用户状态变更通知
- 权限变更广播
- 安全事件推送
- SCIM同步事件

**同步调用机制：**
- RESTful API标准接口
- gRPC高性能服务调用
- Feign客户端声明式调用
- 负载均衡与熔断机制

### API网关设计

**统一入口层：**
- Spring Cloud Gateway作为API网关
- 路由转发与负载均衡
- 请求限流与熔断降级
- 统一认证鉴权
- 请求日志与监控

**协议适配层：**
- SAML 2.0协议适配器
- OAuth2.0/OIDC协议处理器
- CAS协议兼容层
- LDAP协议网关

## 前端架构设计

### 前端技术栈
- Vue 3 + TypeScript
- Element Plus UI组件库
- Pinia状态管理
- Vue Router路由管理
- Axios HTTP客户端

### 前端模块划分

**管理控制台模块：**
- 用户管理界面
- 组织架构管理
- 应用配置管理
- 权限管理界面
- 安全监控面板
- 运营统计大屏

**自助服务平台：**
- 用户注册登录
- 个人资料管理
- 密码重置
- MFA设置
- 权限申请

**开发者门户：**
- 应用注册与管理
- API文档中心
- SDK下载
- 集成指南

### 前端架构模式
- 组件化开发模式
- 微前端架构支持
- 响应式设计适配
- 国际化多语言支持
- 主题定制能力

## 数据访问层设计

### 数据库访问策略

**MyBatis-Plus集成：**
- 通用CRUD操作封装
- 分页查询优化
- SQL注入防护
- 数据库连接池配置

**多数据源支持：**
- 主从数据库读写分离
- 多租户数据隔离
- 数据库连接监控

**缓存策略：**
- Redis分布式缓存
- 用户会话缓存
- 权限数据缓存
- 配置信息缓存

### 数据一致性保障

**分布式事务：**
- 本地事务（@Transactional）
- 最终一致性保证（消息队列）
- Saga补偿事务模式

**数据同步机制：**
- CDC变更数据捕获
- Elasticsearch全文检索同步
- 报表数据库异步同步

## 安全架构设计

### 认证授权体系
- JWT Token无状态认证
- OAuth2.0授权框架
- RBAC权限控制模型
- ABAC属性基访问控制

### 安全防护措施
- HTTPS全链路加密
- CSRF/XSS防护
- SQL注入防护
- 敏感数据加密存储
- API签名验证

### 审计日志设计
- 操作行为完整记录
- 安全事件实时监控
- 合规审计追踪
- 日志分级存储

## 部署架构设计

### 容器化部署
- Docker镜像构建
- Kubernetes编排管理
- Helm Chart包管理
- 滚动升级策略

### 高可用设计
- 服务集群部署
- 数据库主从复制
- 负载均衡配置
- 故障自动恢复

### 监控运维体系
- Prometheus指标监控
- Grafana可视化面板
- ELK日志分析平台
- 告警通知机制

请基于以上要求，输出详细的应用架构设计方案，包括：
1. 系统架构图（微服务拓扑结构）
2. 服务接口设计规范
3. 数据流与调用链路设计
4. 部署架构与扩容方案
5. 性能优化与安全加固方案